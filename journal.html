<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    // 计算相关性的函数
    function npi(table) {
      var res = (table[3] * table[0] - table[2] * table[1]) / Math.sqrt((table[0] + table[1]) *
        (table[2] + table[3]) *
        (table[0] + table[2]) *
        (table[1] + table[3]))
      return res
    }

    var JOURNAL =
      [
        { "events": ["carrot", "exercise", "weekend"], "squirrel": false },
        { "events": ["bread", "pudding", "brushed teeth", "weekend", "touched tree"], "squirrel": false },
        { "events": ["carrot", "nachos", "brushed teeth", "cycling", "weekend"], "squirrel": false },
        { "events": ["brussel sprouts", "ice cream", "brushed teeth", "computer", "weekend"], "squirrel": false },
        { "events": ["potatoes", "candy", "brushed teeth", "exercise", "weekend", "dentist"], "squirrel": false },
        { "events": ["brussel sprouts", "pudding", "brushed teeth", "running", "weekend"], "squirrel": false },
        { "events": ["pizza", "brushed teeth", "computer", "work", "touched tree"], "squirrel": false },
        { "events": ["bread", "beer", "brushed teeth", "cycling", "work"], "squirrel": false },
        { "events": ["cauliflower", "brushed teeth", "work"], "squirrel": false },
        { "events": ["pizza", "brushed teeth", "cycling", "work"], "squirrel": false },
        { "events": ["lasagna", "nachos", "brushed teeth", "work"], "squirrel": false },
        { "events": ["brushed teeth", "weekend", "touched tree"], "squirrel": false },
        { "events": ["lettuce", "brushed teeth", "television", "weekend"], "squirrel": false },
        { "events": ["spaghetti", "brushed teeth", "work"], "squirrel": false },
        { "events": ["brushed teeth", "computer", "work"], "squirrel": false },
        { "events": ["lettuce", "nachos", "brushed teeth", "work"], "squirrel": false },
        { "events": ["carrot", "brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["brushed teeth", "work"], "squirrel": false },
        { "events": ["cauliflower", "reading", "weekend"], "squirrel": false },
        { "events": ["bread", "brushed teeth", "weekend"], "squirrel": false },
        { "events": ["lasagna", "brushed teeth", "exercise", "work"], "squirrel": false },
        { "events": ["spaghetti", "brushed teeth", "reading", "work"], "squirrel": false },
        { "events": ["carrot", "ice cream", "brushed teeth", "television", "work"], "squirrel": false },
        { "events": ["spaghetti", "nachos", "work"], "squirrel": false },
        { "events": ["cauliflower", "ice cream", "brushed teeth", "cycling", "work"], "squirrel": false },
        { "events": ["spaghetti", "peanuts", "computer", "weekend"], "squirrel": true },
        { "events": ["potatoes", "ice cream", "brushed teeth", "computer", "weekend"], "squirrel": false },
        { "events": ["potatoes", "ice cream", "brushed teeth", "work"], "squirrel": false },
        { "events": ["peanuts", "brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["potatoes", "exercise", "work"], "squirrel": false },
        { "events": ["pizza", "ice cream", "computer", "work"], "squirrel": false },
        { "events": ["lasagna", "ice cream", "work"], "squirrel": false },
        { "events": ["cauliflower", "candy", "reading", "weekend"], "squirrel": false },
        { "events": ["lasagna", "nachos", "brushed teeth", "running", "weekend"], "squirrel": false },
        { "events": ["potatoes", "brushed teeth", "work"], "squirrel": false },
        { "events": ["carrot", "work"], "squirrel": false },
        { "events": ["pizza", "beer", "work", "dentist"], "squirrel": false },
        { "events": ["lasagna", "pudding", "cycling", "work"], "squirrel": false },
        { "events": ["spaghetti", "brushed teeth", "reading", "work"], "squirrel": false },
        { "events": ["spaghetti", "pudding", "television", "weekend"], "squirrel": false },
        { "events": ["bread", "brushed teeth", "exercise", "weekend"], "squirrel": false },
        { "events": ["lasagna", "peanuts", "work"], "squirrel": true },
        { "events": ["pizza", "work"], "squirrel": false },
        { "events": ["potatoes", "exercise", "work"], "squirrel": false },
        { "events": ["brushed teeth", "exercise", "work"], "squirrel": false },
        { "events": ["spaghetti", "brushed teeth", "television", "work"], "squirrel": false },
        { "events": ["pizza", "cycling", "weekend"], "squirrel": false },
        { "events": ["carrot", "brushed teeth", "weekend"], "squirrel": false },
        { "events": ["carrot", "beer", "brushed teeth", "work"], "squirrel": false },
        { "events": ["pizza", "peanuts", "candy", "work"], "squirrel": true },
        { "events": ["carrot", "peanuts", "brushed teeth", "reading", "work"], "squirrel": false },
        { "events": ["potatoes", "peanuts", "brushed teeth", "work"], "squirrel": false },
        { "events": ["carrot", "nachos", "brushed teeth", "exercise", "work"], "squirrel": false },
        { "events": ["pizza", "peanuts", "brushed teeth", "television", "weekend"], "squirrel": false },
        { "events": ["lasagna", "brushed teeth", "cycling", "weekend"], "squirrel": false },
        { "events": ["cauliflower", "peanuts", "brushed teeth", "computer", "work", "touched tree"], "squirrel": false },
        { "events": ["lettuce", "brushed teeth", "television", "work"], "squirrel": false },
        { "events": ["potatoes", "brushed teeth", "computer", "work"], "squirrel": false },
        { "events": ["bread", "candy", "work"], "squirrel": false },
        { "events": ["potatoes", "nachos", "work"], "squirrel": false },
        { "events": ["carrot", "pudding", "brushed teeth", "weekend"], "squirrel": false },
        { "events": ["carrot", "brushed teeth", "exercise", "weekend", "touched tree"], "squirrel": false },
        { "events": ["brussel sprouts", "running", "work"], "squirrel": false },
        { "events": ["brushed teeth", "work"], "squirrel": false },
        { "events": ["lettuce", "brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["candy", "brushed teeth", "work"], "squirrel": false },
        { "events": ["brussel sprouts", "brushed teeth", "computer", "work"], "squirrel": false },
        { "events": ["bread", "brushed teeth", "weekend"], "squirrel": false },
        { "events": ["cauliflower", "brushed teeth", "weekend"], "squirrel": false },
        { "events": ["spaghetti", "candy", "television", "work", "touched tree"], "squirrel": false },
        { "events": ["carrot", "pudding", "brushed teeth", "work"], "squirrel": false },
        { "events": ["lettuce", "brushed teeth", "work"], "squirrel": false },
        { "events": ["carrot", "ice cream", "brushed teeth", "cycling", "work"], "squirrel": false },
        { "events": ["pizza", "brushed teeth", "work"], "squirrel": false },
        { "events": ["spaghetti", "peanuts", "exercise", "weekend"], "squirrel": true },
        { "events": ["bread", "beer", "computer", "weekend", "touched tree"], "squirrel": false },
        { "events": ["brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["lettuce", "peanuts", "brushed teeth", "work", "touched tree"], "squirrel": false },
        { "events": ["lasagna", "brushed teeth", "television", "work"], "squirrel": false },
        { "events": ["cauliflower", "brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["carrot", "brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["carrot", "reading", "weekend"], "squirrel": false },
        { "events": ["carrot", "peanuts", "reading", "weekend"], "squirrel": true },
        { "events": ["potatoes", "brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["lasagna", "ice cream", "work", "touched tree"], "squirrel": false },
        { "events": ["cauliflower", "peanuts", "brushed teeth", "cycling", "work"], "squirrel": false },
        { "events": ["pizza", "brushed teeth", "running", "work"], "squirrel": false },
        { "events": ["lettuce", "brushed teeth", "work"], "squirrel": false },
        { "events": ["bread", "brushed teeth", "television", "weekend"], "squirrel": false },
        { "events": ["cauliflower", "peanuts", "brushed teeth", "weekend"], "squirrel": false },
      ]

    function hasEvent(event, entry) {
      return entry.events.includes(event)
    }

    function tableFor(event, journal) {
      var table = [0, 0, 0, 0]
      for (var i = 0; i < journal.length; i++) {
        var entry = journal[i], index = 0
        // 如果事件在这个对象里，也就是事件为真时，（二进制表示）低位加1
        if (hasEvent(event, entry)) {
          index += 1
        }
        // 如果它变成了松鼠
        if (entry.squirrel) {
          index += 2
        }
        // 确定了事件位置，将这个关系加1存在相应的table数组中
        table[index] += 1
      }
      return table
    }
    // 将计算出来的结果（线性关系）映射到一个对象中,函数名：（聚集相关性）
    function gatherCorrelations(journal) {
      var map = {}
      for (var i = 0; i < journal.length; i++) {
        var events = journal[i].events
        for (var j = 0; j < events.length; j++) {
          var event = events[j]
          if (!map[event]) {
            map[event] = npi(tableFor(event, journal))
          }
        }
      }
      return map
    }

    var correlations = gatherCorrelations(JOURNAL)

    // 线性相关超过±0.1的拿出来
    for (var key in correlations) {
      if (correlations[key] > 0.1 || correlations[key] < -0.1) {
        console.log(key + ': ' + correlations[key])
      }
    }

    // 结果显示越吃花生变松鼠的概率越大，越不刷牙变松鼠的概率越大。所以可以将吃花生不刷牙那天添加一项：“peanut no teeth”
    for (var i = 0; i < JOURNAL.length; i++) {
      var entry = JOURNAL[i]
      if (hasEvent('peanuts', entry) && !hasEvent('brushed teeth', entry)) {
        entry.events.push('peanut no teeth')
      }
    }
    var correlations = gatherCorrelations(JOURNAL)
    console.log(correlations)
    console.log(npi(tableFor('peanut no teeth', JOURNAL)))
  </script>
</body>

</html>
